import{bH as c,bB as m,bv as _,bu as v,bG as e,bZ as y,bT as u,c3 as C,b_ as g,bA as b,bL as S,c4 as L}from"./vendor-a57b68ca.js";import{i as M}from"./echarts-7ba4242b.js";import{g as $,d as O,e as T,c as x,T as B}from"./index-e44da831.js";import"./vant-234921e0.js";const F="_wrapper_8sxdi_1",E="_select_8sxdi_5",Y={wrapper:F,select:E},I="_wrapper_wxcjg_1",q={wrapper:I},V={tooltip:{show:!0,trigger:"axis",formatter:([t])=>{const[o,r]=t.data;return`${y(o).format("YYYY年MM月DD日")} ￥${$(r)}`}},grid:[{left:16,top:20,right:16,bottom:20}],xAxis:{type:"time",boundaryGap:["3%","0%"],axisLabel:{formatter:t=>y(t).format("MM-DD")},axisTick:{alignWithLabel:!0}},yAxis:{show:!0,type:"value",splitLine:{show:!0,lineStyle:{type:"dashed"}},axisLabel:{show:!1}}},G=c({props:{data:{type:Array,required:!0}},setup:(t,o)=>{const r=m();let a;return _(()=>{r.value&&(a=M(r.value),a.setOption({...V,series:[{data:t.data,type:"line"}]}))}),v(()=>t.data,()=>{a==null||a.setOption({series:[{data:t.data}]})}),()=>e("div",{ref:r,class:q.wrapper},null)}}),N="_wrapper_1cm6i_1",P={wrapper:N},H={tooltip:{trigger:"item",formatter:t=>{const{name:o,value:r,percent:a}=t;return`${o}: ￥${$(r)} 占比 ${a}%`}},grid:[{left:0,top:0,right:0,bottom:0}],series:[{type:"pie",radius:"70%",emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]},R=c({props:{data:{type:Array}},setup:(t,o)=>{const r=m();let a;return _(()=>{r.value!==void 0&&(a=M(r.value),a.setOption(H))}),v(()=>t.data,()=>{a==null||a.setOption({series:[{data:t.data}]})}),()=>e("div",{ref:r,class:P.wrapper},null)}}),U="_wrapper_1j2wc_1",W="_topItem_1j2wc_5",X="_sign_1j2wc_11",Z="_bar_wrapper_1j2wc_22",z="_bar_text_1j2wc_27",J="_bar_1j2wc_22",K="_bar_inner_1j2wc_41",i={wrapper:U,topItem:W,sign:X,bar_wrapper:Z,bar_text:z,bar:J,bar_inner:K},Q=c({props:{data:{type:Array}},setup:(t,o)=>{const r=()=>{for(var a="0123456789ABCDEF",l="#",n=0;n<6;n++)l+=a[Math.floor(Math.random()*16)];return l};return()=>e("div",{class:i.wrapper},[t.data&&t.data.length>0?t.data.map(({tag:a,amount:l,percent:n})=>e("div",{class:i.topItem},[e("div",{class:i.sign},[a.sign]),e("div",{class:i.bar_wrapper},[e("div",{class:i.bar_text},[e("span",null,[" ",a.name,u(" - "),n,u("%")," "]),e("span",null,[" ",u("￥"),e(O,{value:l},null)," "])]),e("div",{class:i.bar},[e("div",{class:i.bar_inner,style:{width:`${n}%`,background:`${r()}`}},null)])])])):e("div",null,[u("没有数据")])])}});y.extend(C);const tt=c({props:{startDate:{type:g.Dayjs,required:!0},endDate:{type:g.Dayjs,required:!0}},setup:(t,o)=>{const r=T(),a=m([]),l=b(()=>{const s=y.duration(t.endDate.diff(t.startDate)).asDays()+1;return Array.from({length:s}).map((d,f)=>{const D=t.startDate.add(f,"day").format("YYYY-MM-DD"),h=a.value[0],A=h&&h.happen_at===D?a.value.shift().amount:0;return[D,A]})}),n=async()=>{const s=await x.get("/items/summary",{happen_after:t.startDate.format("YYYY-MM-DD"),happen_before:t.endDate.format("YYYY-MM-DD"),kind:r.kind,group_by:"happen_at"},{_mock:"itemSummary",_autoLoading:!0});a.value=s.data.groups.reverse()};_(n);const p=m([]),j=b(()=>p.value.map(s=>({name:s.tag.name,value:s.amount}))),k=b(()=>{const s=p.value.reduce((d,f)=>d+f.amount,0);return p.value.map(d=>({...d,percent:Math.round(d.amount/s*100)}))}),w=async()=>{const s=await x.get("/items/summary",{happen_after:t.startDate.format("YYYY-MM-DD"),happen_before:t.endDate.format("YYYY-MM-DD"),kind:r.kind,group_by:"tag_id"},{_mock:"itemSummary"});p.value=s.data.groups};return _(w),v(()=>[r.kind,t.startDate,t.endDate],()=>{n(),w()}),()=>e("div",{class:Y.wrapper},[e("div",{class:Y.select},[e("span",null,[u("类型")]),S(e("select",{"onUpdate:modelValue":s=>r.kind=s,style:r.kind==="expenses"?{color:"green"}:{color:"red"}},[e("option",{value:"expenses",style:{color:"green"}},[u("支出")]),e("option",{value:"income",style:{color:"red"}},[u("收入")])]),[[L,r.kind]])]),e(G,{data:l.value},null),e(R,{data:j.value},null),e(Q,{data:k.value},null)])}}),nt=c({setup:()=>()=>e(B,{rerenderOnSelect:!0,hideThisYear:!0,component:tt},null)});export{nt as StatisticsPage,nt as default};
